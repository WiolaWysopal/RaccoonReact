<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>JWT Test</title>
</head>
<body>

<button onclick="login()">1. Login</button>
<button onclick="attackManipulation()">Atak 1 – manipulacja</button>
<button onclick="attackReplay()">Atak 2 – replay</button>
<button onclick="attackBruteForce()">Atak 3 – brute force</button>

<pre id="out"></pre>

<script>
let accessToken = "";
let refreshToken = "";
let fakeToken = "";

// -------------------- LOGIN --------------------
async function login() {
    const res = await fetch("http://localhost:3000/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username: "Anna" })
    });
    const data = await res.json();

    accessToken = data.accessToken;
    refreshToken = data.refreshToken;

    // FAKE TOKEN (zmieniony payload)
    const parts = accessToken.split(".");
    fakeToken = parts[0] + "." + btoa(`{"username":"Admin"}`) + "." + parts[2];

    print("Access token:\n" + accessToken +
          "\n\nRefresh token:\n" + refreshToken +
          "\n\nFAKE TOKEN:\n" + fakeToken);
}

// ----------------- ATAK 1 -----------------------
async function attackManipulation() {
    const res = await fetch("http://localhost:3000/attack-manipulation", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ fakeToken: fakeToken })
    });
    print(JSON.stringify(await res.json(), null, 2));
}

// ----------------- ATAK 2 -----------------------
async function attackReplay() {
    const res = await fetch("http://localhost:3000/attack-replay", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: accessToken })
    });
    print(JSON.stringify(await res.json(), null, 2));
}

// ----------------- ATAK 3 -----------------------
async function attackBruteForce() {
    const res = await fetch("http://localhost:3000/attack-bruteforce");
    print(JSON.stringify(await res.json(), null, 2));
}

// -------------------- OUTPUT --------------------
function print(msg) {
    document.getElementById("out").textContent = msg;
}
</script>

</body>
</html>
